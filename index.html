<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>File Compressor (Video)</title>

  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    .box { background: white; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #log { white-space: pre-line; background: #000; color: #0f0; padding: 10px; margin-top:20px; height:150px; overflow:auto; }
  </style>

  <!-- Load ffmpeg.wasm CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
</head>
<body>
  <div class="box">
    <h2>Video Compressor</h2>

    <input type="file" id="fileInput" accept="video/*"><br><br>

    <button id="compressBtn">Compress</button>

    <h3>Output:</h3>
    <a id="downloadLink" style="display:none;" download="compressed.mp4">Download Compressed File</a>

    <div id="log"></div>
  </div>

  <script>
    const { FFmpeg } = FFmpegWASM;
    const logBox = document.getElementById("log");

    function log(msg) {
      logBox.textContent += msg + "\n";
      logBox.scrollTop = logBox.scrollHeight;
    }

    const ffmpeg = new FFmpeg();

    async function loadFFmpeg() {
      log("Loading FFmpeg...");
      await ffmpeg.load({
        coreURL: "https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js",
      });
      log("FFmpeg Loaded!");
    }

    loadFFmpeg();

    document.getElementById("compressBtn").addEventListener("click", async () => {
      const file = document.getElementById("fileInput").files[0];

      if (!file) return alert("Upload a file first!");

      if (file.size > 500 * 1024 * 1024) {
        alert("Each file must be under 500 MB!");
        return;
      }

      log("Reading file: " + file.name);

      await ffmpeg.writeFile("input.mp4", await file.arrayBuffer());

      log("Compressing... This may take time.");

      await ffmpeg.exec([
        "-i", "input.mp4",
        "-vcodec", "libx264",
        "-crf", "28",
        "output.mp4"
      ]);

      log("Compression Completed!");

      const data = await ffmpeg.readFile("output.mp4");

      const blob = new Blob([data.buffer], { type: "video/mp4" });
      const url = URL.createObjectURL(blob);

      const link = document.getElementById("downloadLink");
      link.href = url;
      link.style.display = "block";
      link.textContent = "Download Compressed Video";
    });
  </script>
</body>
</html>
