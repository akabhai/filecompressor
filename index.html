<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Video Compressor</title>

  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    #log { background: #fff; padding: 15px; border: 1px solid #ccc; border-radius: 8px; height: 150px; overflow-y: auto; margin-top: 20px; }
    button { padding: 12px 20px; border: none; background: #2b7bff; color: white; border-radius: 6px; cursor: pointer; }
  </style>

  <!-- FFmpeg WASM -->
  <script type="module">
    import { FFmpeg } from "https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js";

    window.ffmpeg = new FFmpeg();
  </script>
</head>
<body>

  <h2>Advanced Video Compressor</h2>
  <input type="file" id="inputVideo" accept="video/*">

  <br><br>
  <button onclick="compressVideo()">Compress Video</button>

  <div id="log"></div>

<script>
function log(msg) {
    document.getElementById("log").innerHTML += msg + "<br>";
}

/* NOW WE EXPOSE THE FUNCTION TO WINDOW */
window.compressVideo = async function () {
    const inputFile = document.getElementById("inputVideo").files[0];
    if (!inputFile) { alert("Please select a video first!"); return; }

    log("Loading FFmpeg...");
    await window.ffmpeg.load();

    log("Reading file...");
    const data = new Uint8Array(await inputFile.arrayBuffer());
    await window.ffmpeg.writeFile("input.mp4", data);

    log("Compressing video... (this may take minutes)");

    await window.ffmpeg.exec([
        "-i", "input.mp4",
        "-vcodec", "libx264",
        "-crf", "28",
        "-preset", "veryfast",
        "output.mp4"
    ]);

    log("Preparing download...");
    const output = await window.ffmpeg.readFile("output.mp4");
    const blob = new Blob([output.buffer], { type: "video/mp4" });

    const url = URL.createObjectURL(blob);
    log(`<a href='${url}' download='compressed.mp4'>Download Compressed Video</a>`);
};  
</script>

</body>
</html>
